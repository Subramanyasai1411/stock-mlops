<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Stock MLOps Dashboard</title>
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.1/chart.umd.min.js"></script>
<style>
:root{--bg:#0a0e17;--card:#111827;--card2:#1a2332;--border:#1e293b;--t1:#f1f5f9;--t2:#94a3b8;--t3:#64748b;--green:#10b981;--red:#ef4444;--blue:#3b82f6;--amber:#f59e0b;--grad:linear-gradient(135deg,#3b82f6,#8b5cf6)}*{margin:0;padding:0;box-sizing:border-box}body{font-family:'DM Sans',sans-serif;background:var(--bg);color:var(--t1);min-height:100vh}body::before{content:'';position:fixed;inset:0;background-image:linear-gradient(rgba(59,130,246,.03) 1px,transparent 1px),linear-gradient(90deg,rgba(59,130,246,.03) 1px,transparent 1px);background-size:60px 60px;pointer-events:none}.app{position:relative;z-index:1}.banner{display:none;padding:14px 40px;background:linear-gradient(90deg,rgba(245,158,11,.1),rgba(59,130,246,.1));border-bottom:1px solid rgba(245,158,11,.2);font-size:14px;color:var(--amber);text-align:center;animation:bp 2s ease-in-out infinite}.banner.on{display:block}.banner b{font-family:'JetBrains Mono',monospace}@keyframes bp{0%,100%{opacity:1}50%{opacity:.7}}header{padding:20px 40px;display:flex;align-items:center;justify-content:space-between;border-bottom:1px solid var(--border);backdrop-filter:blur(20px);background:rgba(10,14,23,.8);position:sticky;top:0;z-index:100}.logo{display:flex;align-items:center;gap:14px}.logo i{width:40px;height:40px;background:var(--grad);border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:20px;font-style:normal;box-shadow:0 4px 20px rgba(59,130,246,.3)}.logo b{font-size:20px;font-weight:700;letter-spacing:-.5px}.logo span{color:var(--t3);font-weight:400}.hdr-r{display:flex;align-items:center;gap:12px}.badge{display:flex;align-items:center;gap:8px;padding:6px 14px;border-radius:20px;font-size:13px;font-weight:500;background:rgba(16,185,129,.1);color:var(--green);border:1px solid rgba(16,185,129,.2)}.badge.trn{background:rgba(245,158,11,.1);color:var(--amber);border-color:rgba(245,158,11,.2)}.badge .dot{width:8px;height:8px;background:var(--green);border-radius:50%;animation:p 2s ease-in-out infinite}.badge.trn .dot{background:var(--amber)}@keyframes p{0%,100%{opacity:1}50%{opacity:.4}}.btn{background:var(--card);border:1px solid var(--border);color:var(--t2);padding:8px 16px;border-radius:8px;font-family:inherit;font-size:13px;cursor:pointer;transition:all .2s;display:flex;align-items:center;gap:6px}.btn:hover{background:var(--card2);color:var(--t1);border-color:var(--blue)}.btn-r{background:rgba(59,130,246,.1)!important;border-color:rgba(59,130,246,.3)!important;color:var(--blue)!important}.btn-r:hover{background:rgba(59,130,246,.2)!important}.btn-r.trn{background:rgba(245,158,11,.1)!important;border-color:rgba(245,158,11,.3)!important;color:var(--amber)!important;pointer-events:none}@keyframes spin{to{transform:rotate(360deg)}}.btn-r.trn svg{animation:spin 2s linear infinite}main{padding:28px 40px;max-width:1440px;margin:0 auto}.ctrl{display:flex;align-items:center;gap:16px;margin-bottom:24px;flex-wrap:wrap}.tabs{display:flex;gap:8px}.tab{padding:10px 24px;border-radius:8px;font-family:'JetBrains Mono',monospace;font-size:14px;font-weight:500;background:var(--card);border:1px solid var(--border);color:var(--t2);cursor:pointer;transition:all .2s}.tab:hover{background:var(--card2);color:var(--t1)}.tab.on{background:rgba(59,130,246,.08);border-color:var(--blue);color:var(--blue);box-shadow:0 0 20px rgba(59,130,246,.15)}.dctl{display:flex;align-items:center;gap:10px;margin-left:auto}.dctl label{font-size:13px;color:var(--t3)}.dctl select{background:var(--card);border:1px solid var(--border);color:var(--t1);padding:10px 36px 10px 16px;border-radius:8px;font-family:'JetBrains Mono',monospace;font-size:14px;cursor:pointer;outline:none;appearance:none;background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' fill='%2394a3b8' viewBox='0 0 16 16'%3E%3Cpath d='M7.247 11.14L2.451 5.658C1.885 5.013 2.345 4 3.204 4h9.592a1 1 0 01.753 1.659l-4.796 5.48a1 1 0 01-1.506 0z'/%3E%3C/svg%3E");background-repeat:no-repeat;background-position:right 12px center;min-width:150px}.dctl select:focus{border-color:var(--blue)}.stats{display:grid;grid-template-columns:repeat(4,1fr);gap:16px;margin-bottom:24px}.sc{background:var(--card);border:1px solid var(--border);border-radius:12px;padding:20px 24px;transition:all .3s}.sc:hover{border-color:rgba(59,130,246,.3);transform:translateY(-2px);box-shadow:0 10px 40px rgba(0,0,0,.4)}.sc .l{font-size:12px;font-weight:600;text-transform:uppercase;letter-spacing:1px;color:var(--t3);margin-bottom:8px}.sc .v{font-size:28px;font-weight:700;font-family:'JetBrains Mono',monospace;letter-spacing:-1px}.sc .c{font-size:13px;font-weight:500;margin-top:6px;display:flex;align-items:center;gap:4px}.sc .c.pos{color:var(--green)}.sc .c.neg{color:var(--red)}.g2{display:grid;grid-template-columns:2fr 1fr;gap:20px;margin-bottom:24px}.card{background:var(--card);border:1px solid var(--border);border-radius:12px;padding:24px;transition:border-color .3s}.card:hover{border-color:rgba(59,130,246,.2)}.card h3{font-size:15px;font-weight:600;margin-bottom:4px}.card .sub{font-size:12px;color:var(--t3);margin-bottom:20px}.chrt{position:relative;height:340px}.mi{display:flex;flex-direction:column;gap:10px}.mi .r{display:flex;justify-content:space-between;padding:10px 14px;background:rgba(59,130,246,.04);border-radius:8px;font-size:13px}.mi .r .k{color:var(--t3)}.mi .r .val{font-family:'JetBrains Mono',monospace;color:var(--t1);font-weight:500}.pred{margin-top:16px;background:linear-gradient(135deg,rgba(59,130,246,.1),rgba(139,92,246,.08));border:1px solid rgba(59,130,246,.2);border-radius:12px;padding:20px;text-align:center}.pred .lbl{font-size:11px;text-transform:uppercase;letter-spacing:1.5px;color:var(--t3);margin-bottom:6px}.pred .price{font-size:32px;font-weight:700;font-family:'JetBrains Mono',monospace;background:var(--grad);-webkit-background-clip:text;-webkit-text-fill-color:transparent}.pred .meta{font-size:12px;color:var(--t3);margin-top:6px}.fchrt{position:relative;height:280px;margin-top:16px}.flist{margin-top:12px;max-height:220px;overflow-y:auto}.frow{display:flex;justify-content:space-between;padding:8px 14px;border-radius:6px;font-size:13px;font-family:'JetBrains Mono',monospace;transition:background .2s}.frow:hover{background:rgba(59,130,246,.06)}.frow .d{color:var(--t3);min-width:36px}.frow .dt{color:var(--t2)}.frow .p{font-weight:500}table{width:100%;border-collapse:collapse}th{text-align:left;font-size:11px;font-weight:600;text-transform:uppercase;letter-spacing:1px;color:var(--t3);padding:12px 16px;border-bottom:1px solid var(--border)}td{padding:12px 16px;font-size:13px;font-family:'JetBrains Mono',monospace;border-bottom:1px solid rgba(30,41,59,.5);color:var(--t2)}tr:hover td{background:rgba(59,130,246,.04);color:var(--t1)}.pipe{display:grid;grid-template-columns:repeat(3,1fr);gap:16px;margin-bottom:24px}.pc{background:var(--card);border:1px solid var(--border);border-radius:12px;padding:20px;display:flex;align-items:center;gap:16px}.pc i{width:44px;height:44px;border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:20px;font-style:normal;flex-shrink:0}.pc .n{font-size:14px;font-weight:600;margin-bottom:2px}.pc .s{font-size:12px;color:var(--t3)}@media(max-width:1024px){main{padding:20px}.stats{grid-template-columns:repeat(2,1fr)}.g2{grid-template-columns:1fr}.pipe{grid-template-columns:1fr}}@media(max-width:640px){header{padding:16px 20px;flex-wrap:wrap;gap:12px}.stats{grid-template-columns:1fr}.ctrl{flex-direction:column;align-items:stretch}.dctl{margin-left:0}}
</style>
</head>
<body>
<div class="app">
<div class="banner" id="ban">&#129504; Training in progress... <b id="banT"></b></div>
<header><div class="logo"><i>&#128200;</i><b>StockML <span>ops</span></b></div><div class="hdr-r"><div class="badge" id="bdg"><div class="dot"></div><span id="bdgT">API Connected</span></div><button class="btn btn-r" id="rbtn" onclick="retrain()"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2v4m0 12v4M4.93 4.93l2.83 2.83m8.48 8.48l2.83 2.83M2 12h4m12 0h4M4.93 19.07l2.83-2.83m8.48-8.48l2.83-2.83"/></svg> Retrain Models</button><button class="btn" onclick="doRefresh()"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 2v6h-6"/><path d="M3 12a9 9 0 0 1 15-6.7L21 8"/><path d="M3 22v-6h6"/><path d="M21 12a9 9 0 0 1-15 6.7L3 16"/></svg> Refresh</button></div></header>
<main>
<div class="pipe"><div class="pc"><i style="background:rgba(16,185,129,.1)">&#128202;</i><div><div class="n">Data Ingestion</div><div class="s">Daily @ 6 PM Weekdays</div></div></div><div class="pc"><i style="background:rgba(59,130,246,.1)">&#129504;</i><div><div class="n">Model Training</div><div class="s">Monthly + On-demand</div></div></div><div class="pc"><i style="background:rgba(245,158,11,.1)">&#9889;</i><div><div class="n">Inference API</div><div class="s">Real-time @ :8000</div></div></div></div>
<div class="ctrl"><div class="tabs" id="tabs"></div><div class="dctl"><label>Forecast:</label><select id="days" onchange="loadPred()"><option value="1">1 Day</option><option value="3">3 Days</option><option value="5">5 Days</option><option value="7" selected>7 Days</option><option value="10">10 Days</option><option value="14">14 Days</option><option value="20">20 Days</option><option value="30">30 Days</option></select></div></div>
<div class="stats" id="sts"></div>
<div class="g2"><div class="card"><h3>Price History</h3><div class="sub">Close prices - last 12 months</div><div class="chrt"><canvas id="pc1"></canvas></div></div><div><div class="card"><h3>Active Model</h3><div class="sub" style="margin-bottom:12px"></div><div class="mi" id="mi"></div></div><div class="pred"><div class="lbl">Next Day Prediction</div><div class="price" id="pp">-</div><div class="meta" id="pm">Loading...</div></div></div></div>
<div class="g2" id="fsec" style="display:none"><div class="card"><h3 id="fttl">Forecast</h3><div class="sub">Predicted prices</div><div class="fchrt"><canvas id="fc1"></canvas></div></div><div class="card"><h3>Forecast Details</h3><div class="sub"></div><div class="flist" id="fl"></div></div></div>
<div class="card"><h3>Recent Data</h3><div class="sub" style="margin-bottom:16px">Latest ingested records</div><div style="overflow-x:auto"><table><thead><tr><th>Date</th><th>Open</th><th>High</th><th>Low</th><th>Close</th><th>Volume</th></tr></thead><tbody id="tb"><tr><td colspan="6" style="text-align:center;padding:40px">Loading...</td></tr></tbody></table></div></div>
</main></div>
<script>
const API='http://localhost:8000',TK=['AAPL','GOOGL','MSFT','AMZN'];let cur=TK[0],C1=null,C2=null,poll=null;const $=id=>document.getElementById(id);
async function api(u,o={}){try{const r=await fetch(API+u,{method:o.method||'GET',...o});if(!r.ok)throw r;return await r.json()}catch(e){console.error(u,e);return null}}
function fv(v){return v>=1e9?(v/1e9).toFixed(1)+'B':v>=1e6?(v/1e6).toFixed(1)+'M':v>=1e3?(v/1e3).toFixed(1)+'K':v+''}
function mkTabs(){$('tabs').innerHTML=TK.map(t=>'<button class="tab '+(t==cur?'on':'')+'" onclick="sw(\''+t+'\')">'+t+'</button>').join('')}
function mkStats(d){var c=$('sts');if(!d||!d.length){c.innerHTML='<div style="grid-column:1/-1;text-align:center;color:var(--t3);padding:20px">No data yet - startup is loading...</div>';return}var l=d[d.length-1],p=d.length>1?d[d.length-2]:l,f=d[0];var ch=l.close_price-p.close_price,cp=ch/p.close_price*100,yc=l.close_price-f.close_price,yp=yc/f.close_price*100;var hi=Math.max.apply(null,d.map(function(x){return x.high_price})),lo=Math.min.apply(null,d.map(function(x){return x.low_price})),av=d.reduce(function(s,x){return s+x.volume},0)/d.length;c.innerHTML='<div class="sc"><div class="l">Last Close</div><div class="v">$'+l.close_price.toFixed(2)+'</div><div class="c '+(ch>=0?'pos':'neg')+'">'+(ch>=0?'&#9650;':'&#9660;')+' '+Math.abs(ch).toFixed(2)+' ('+cp.toFixed(2)+'%)</div></div><div class="sc"><div class="l">Year Change</div><div class="v">'+(yp>=0?'+':'')+yp.toFixed(1)+'%</div><div class="c '+(yc>=0?'pos':'neg')+'">'+(yc>=0?'&#9650;':'&#9660;')+' $'+Math.abs(yc).toFixed(2)+'</div></div><div class="sc"><div class="l">52W Range</div><div class="v">$'+lo.toFixed(0)+' - $'+hi.toFixed(0)+'</div><div class="c" style="color:var(--t3)">High / Low</div></div><div class="sc"><div class="l">Avg Volume</div><div class="v">'+fv(av)+'</div><div class="c" style="color:var(--t3)">'+d.length+' pts</div></div>'}
function mkChart(d){var ctx=$('pc1').getContext('2d');if(C1)C1.destroy();var g=ctx.createLinearGradient(0,0,0,340);g.addColorStop(0,'rgba(59,130,246,.15)');g.addColorStop(1,'rgba(59,130,246,0)');C1=new Chart(ctx,{type:'line',data:{labels:d.map(function(x){return x.date}),datasets:[{data:d.map(function(x){return x.close_price}),borderColor:'#3b82f6',backgroundColor:g,fill:true,tension:.3,borderWidth:2,pointRadius:0,pointHoverRadius:5,pointHoverBackgroundColor:'#3b82f6'}]},options:{responsive:true,maintainAspectRatio:false,interaction:{intersect:false,mode:'index'},plugins:{legend:{display:false},tooltip:{backgroundColor:'#1e293b',bodyFont:{family:'JetBrains Mono',size:14},callbacks:{label:function(c){return '$'+c.parsed.y.toFixed(2)}}}},scales:{x:{grid:{color:'rgba(30,41,59,.5)',drawBorder:false},ticks:{color:'#64748b',font:{family:'JetBrains Mono',size:10},maxTicksLimit:8,maxRotation:0}},y:{grid:{color:'rgba(30,41,59,.5)',drawBorder:false},ticks:{color:'#64748b',font:{family:'JetBrains Mono',size:11},callback:function(v){return '$'+v.toFixed(0)}}}}}})}
function mkModel(i){var c=$('mi');if(!i){c.innerHTML='<div class="r"><span class="k">Status</span><span class="val" style="color:var(--amber)">No model trained</span></div><div class="r"><span class="k">Tip</span><span class="val" style="font-size:11px">Click Retrain Models</span></div>';return}var m=i.metrics||{};c.innerHTML='<div class="r"><span class="k">Architecture</span><span class="val">'+i.model_name+'</span></div><div class="r"><span class="k">Version</span><span class="val">'+i.version+'</span></div><div class="r"><span class="k">RMSE</span><span class="val">'+(m.rmse?m.rmse.toFixed(4):'-')+'</span></div><div class="r"><span class="k">Train/Val Loss</span><span class="val">'+(m.train_loss?m.train_loss.toFixed(6):'-')+' / '+(m.val_loss?m.val_loss.toFixed(6):'-')+'</span></div><div class="r"><span class="k">Trained</span><span class="val">'+(i.created_at||'').split('.')[0]+'</span></div>'}
function mkPred(p){var pp=$('pp'),pm=$('pm');if(!p||p.error){pp.textContent='-';pm.textContent=p?p.error:'No prediction';return}pp.textContent='$'+p.predicted_price.toFixed(2);var d=p.predicted_price-p.last_actual_price,pct=(d/p.last_actual_price*100).toFixed(2);pm.innerHTML='<span style="color:'+(d>=0?'var(--green)':'var(--red)')+'">'+(d>=0?'&#9650;':'&#9660;')+' '+Math.abs(pct)+'%</span> from $'+p.last_actual_price+' | '+p.model_version}
function mkForecast(p){var sec=$('fsec');if(!p||!p.forecast||p.forecast.length<=1){sec.style.display='none';return}sec.style.display='grid';$('fttl').textContent=p.ticker+' - '+p.days+'-Day Forecast';var ctx=$('fc1').getContext('2d');if(C2)C2.destroy();var pr=p.forecast.map(function(f){return f.predicted_price}),dt=p.forecast.map(function(f){return f.date}),sp=p.last_actual_price;var all=[sp].concat(pr),ad=[p.last_date+' (actual)'].concat(dt),up=pr[pr.length-1]>=sp;var g=ctx.createLinearGradient(0,0,0,280);g.addColorStop(0,up?'rgba(16,185,129,.15)':'rgba(239,68,68,.15)');g.addColorStop(1,'transparent');C2=new Chart(ctx,{type:'line',data:{labels:ad,datasets:[{data:all,borderColor:up?'#10b981':'#ef4444',backgroundColor:g,fill:true,tension:.3,borderWidth:2.5,pointRadius:4,pointBackgroundColor:up?'#10b981':'#ef4444',pointBorderColor:'#111827',pointBorderWidth:2}]},options:{responsive:true,maintainAspectRatio:false,interaction:{intersect:false,mode:'index'},plugins:{legend:{display:false},tooltip:{backgroundColor:'#1e293b',bodyFont:{family:'JetBrains Mono',size:13},callbacks:{label:function(c){return '$'+c.parsed.y.toFixed(2)}}}},scales:{x:{grid:{color:'rgba(30,41,59,.3)',drawBorder:false},ticks:{color:'#64748b',font:{family:'JetBrains Mono',size:10},maxRotation:45}},y:{grid:{color:'rgba(30,41,59,.3)',drawBorder:false},ticks:{color:'#64748b',font:{family:'JetBrains Mono',size:11},callback:function(v){return '$'+v.toFixed(0)}}}}}});$('fl').innerHTML=p.forecast.map(function(f){var c=f.predicted_price-sp,pct=(c/sp*100).toFixed(2),col=c>=0?'var(--green)':'var(--red)';return '<div class="frow"><span class="d">D'+f.day+'</span><span class="dt">'+f.date+'</span><span class="p" style="color:'+col+'">$'+f.predicted_price.toFixed(2)+' ('+(c>=0?'+':'')+pct+'%)</span></div>'}).join('')}
function mkTable(d){var t=$('tb');if(!d||!d.length){t.innerHTML='<tr><td colspan="6" style="text-align:center;padding:40px;color:var(--t3)">No data</td></tr>';return}t.innerHTML=d.slice(-15).reverse().map(function(x){return '<tr><td>'+x.date+'</td><td>$'+x.open_price.toFixed(2)+'</td><td>$'+x.high_price.toFixed(2)+'</td><td>$'+x.low_price.toFixed(2)+'</td><td style="color:var(--t1);font-weight:500">$'+x.close_price.toFixed(2)+'</td><td>'+fv(x.volume)+'</td></tr>'}).join('')}
async function load(t){var d=await api('/data/'+t+'?days=365');if(d&&d.length){mkStats(d);mkChart(d);mkTable(d)}else{mkStats(null);mkTable(null)}var m=await api('/models/'+t+'/active').catch(function(){return null});mkModel(m);await loadPred()}
async function loadPred(){var days=$('days').value;var p=await api('/predict/'+cur+'?days='+days);mkPred(p);mkForecast(p)}
function sw(t){cur=t;mkTabs();load(t)}
function doRefresh(){load(cur)}
async function retrain(){await api('/retrain',{method:'POST'});startPoll()}
async function chkTrain(){var s=await api('/training-status');if(!s)return;if(s.is_training){$('ban').classList.add('on');$('rbtn').classList.add('trn');$('bdg').classList.add('trn');$('bdgT').textContent='Training';var dn=[];for(var k in s.progress){if(s.progress[k].status==='success')dn.push(k)}$('banT').textContent=dn.length?'Done: '+dn.join(', ')+' | Now: '+(s.current_ticker||'...'):'('+(s.current_ticker||'...')+')';}else{$('ban').classList.remove('on');$('rbtn').classList.remove('trn');$('bdg').classList.remove('trn');$('bdgT').textContent='API Connected';if(poll){clearInterval(poll);poll=null;load(cur)}}}
function startPoll(){if(poll)return;poll=setInterval(chkTrain,3000);chkTrain()}
mkTabs();load(cur);chkTrain().then(function(){api('/training-status').then(function(s){if(s&&s.is_training)startPoll()})});setInterval(function(){if(!poll)chkTrain()},15000);
</script>
</body></html>
